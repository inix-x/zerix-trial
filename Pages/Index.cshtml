@page
@model IndexModel
@{
    ViewData["Title"] = "Inbox";
    ViewData["User"] = "Admin";
}

<div class="container-fluid mt-md-4 mt-2 px-0">
    <div class="row no-gutters">
        <!-- Sidebar -->
        <nav class="col-md-4 d-none d-md-block sidebar">
            <ul class="navbar-nav pb-2 mb-4">
                <li class="nav-item dropdown d-none d-sm-block">
                    <a class="fs-5 nav-link text-dark d-flex flex-row align-items-center justify-content-between btn-orange border-orange py-2 px-4 px-md-4 py-md-3" href="#" id="navbarDropdownMenuLink2" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="d-flex align-items-center px-2">
                            <img src="~/images/icons/department.svg" height="24" width="24" alt="Department" class="d-inline-block align-top me-3 color-primary" />
                            <span class="txt-color-primary fs-20 fw-400 me-2">Departments</span>
                        </div>
                        <img src="~/images/icons/arrow-down.svg" height="14" width="14" alt="arrow-down" class="d-inline-block" />
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink2">
                        <li><a class="dropdown-item" href="#">Department 1</a></li>
                        <li><a class="dropdown-item" href="#">Department 2</a></li>
                    </ul>
                </li>
            </ul>
            
            <ul class="nav flex-column pt-4 mt-4">
                <li class="nav-item">   
                    <a class="nav-link py-2 px-4 options rounded-top d-flex align-items-center active custom-active" href="/">
                        <img src="~/images/icons/edit-active.svg" height="24" width="24" alt="Compose" class="d-inline-block me-2" />
                        <span class="fs-20  ff-microsoft-sans-serif px-2 py-2">Compose</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link py-2 px-4 options options-border d-flex align-items-center" href="/Inbox">
                        <img src="~/images/icons/mail-orange.svg" height="24" width="24" alt="Inbox" class="d-inline-block me-2" />
                        <span class="fs-20  ff-microsoft-sans-serif px-2 py-2">Inbox</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link py-2 px-4 options options-border d-flex align-items-center" href="#">
                        <img src="~/images/icons/sent.svg" height="24" width="24" alt="Sent" class="d-inline-block me-2" />
                        <span class="fs-20  ff-microsoft-sans-serif px-2 py-2">Sent</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link py-2 px-4 options options-border d-flex align-items-center" href="#">
                        <img src="~/images/icons/outbox.svg" height="24" width="24" alt="Outbox" class="d-inline-block me-2" />
                        <span class="fs-20  ff-microsoft-sans-serif px-2 py-2">Outbox</span>
                    </a>
                </li>
            </ul>
        </nav>
        <!-- Sidebar for Mobile View -->
        <nav class="sidebar-mobile d-md-none">
            <!-- Department Dropdown Button -->
            <div class="d-flex align-items-center py-2">
                @* <a class="btn btn-outline-orange box rounded d-flex align-items-center me-2" href="#"> *@
                <a class="box nav-link txt-color-primary d-flex justify-content-center btn-orange border-orange"  href="#" data-bs-toggle="offcanvas" data-bs-target="#departmentOffcanvas" aria-controls="departmentOffcanvas">
                    <img src="~/images/icons/department.svg" alt="Department" height="20" width="20" class="d-inline-block" />
                    <img src="~/images/icons/arrow-down.svg" height="12" width="12" alt="arrow-down" class="d-inline-block ms-1" />
                </a>
            </div>
            
            <!-- Icons for Mobile Sidebar -->
            <div class="d-flex gap-2 justify-content-end">
                <a class="box item bg-orange-light d-flex align-items-center justify-content-center p-2 active" href="/">
                    <img src="~/images/icons/edit-active.svg" height="24" width="24" alt="Compose" class="d-inline-block" />
                </a>
                <a class="box item bg-orange d-flex align-items-center justify-content-center p-2 " href="/Inbox">
                    <img src="~/images/icons/mail-orange.svg" height="24" width="24" alt="Inbox" class="d-inline-block" />
                </a>
                <a class="box item bg-orange-light d-flex align-items-center justify-content-center p-2" href="#">
                    <img src="~/images/icons/sent.svg" height="24" width="24" alt="Sent" class="d-inline-block" />
                </a>
                <a class="box item bg-orange-light d-flex align-items-center justify-content-center p-2" href="#">
                    <img src="~/images/icons/outbox.svg" height="24" width="24" alt="Outbox" class="d-inline-block" />
                </a>
            </div>
        </nav>

        <div class="offcanvas offcanvas-bottom" tabindex="-2" id="departmentOffcanvas" aria-labelledby="departmentOffcanvasLabel">
            <div class="offcanvas-body">
                <ul class="navbar-nav">
                    <li><a class="nav-link txt-color-secondary" href="#">Department 1</a></li>
                    <li><a class="nav-link txt-color-secondary" href="#">Department 2</a></li>
                </ul>
            </div>
        </div>

        <main class="col-md-8 ms-sm-auto message-compose px-md-4">
            <div class="mb-md-4 d-flex align-items-center justify-content-between">
                <h1 class="fs-24 fw-normal d-none d-md-block txt-color-secondary">COMPOSE</h1>
            </div>
            <div class="rounded border hide-border px-md-4 py-md-4">
                <div class="d-flex justify-content-between mt-md-0 mt-4">
                    <div class="mb-md-4 d-flex align-items-center justify-content-between">
                        <h1 class="fs-24 fw-normal d-md-none d-block ff-microsoft-sans-serif txt-color-secondary">COMPOSE</h1>
                    </div>
                    <div class="d-flex flex-row justify-content-end">
                        <label class="form-label txt-color-primary mb-2 cursor-pointer ff-microsoft-sans-serif" onchange="useTemplate()">
                            Use Template
                        </label>
                    </div>
                </div>
                <form action="" class="mx-md-4">
                    <div class="my-4">
                        <label for="recipients" class="form-label">To</label>
                        <div class="input-group d-none d-md-flex">
                            <!-- Recipient Pills (Using Badges to Represent Pills) -->
                            <div class="form-control recipients d-flex flex-wrap me-3 border rounded">
                                <span class="badge badge-color ff-microsoft-sans-serif mx-2 d-flex align-items-center rounded-pill fw-400">Ethan Patel
                                    <button type="button" class="recipients btn-close btn-close-white ms-2" aria-label="Remove"></button>
                                </span>
                                <span class="badge badge-color ff-microsoft-sans-serif mx-2 d-flex align-items-center rounded-pill fw-400">Liam Garcia
                                    <button type="button" class="recipients btn-close btn-close-white ms-2" aria-label="Remove"></button>
                                </span>
                                <span class="badge badge-color ff-microsoft-sans-serif mx-2 d-flex align-items-center rounded-pill fw-400">Sophia Kim
                                    <button type="button" class="recipients btn-close btn-close-white ms-2" aria-label="Remove"></button>
                                </span>
                            </div>
                            <!-- Groups Button -->
                            <button type="button" class="btn btn-orange-fill rounded px-md-4 py-md-2 me-2">Groups</button>
                            <!-- Contacts Button -->
                            <button type="button" class="btn btn-orange border-orange rounded d-flex align-items-center px-md-2 py-md-2">
                                <img src="~/images/icons/contacts.svg" alt="Logo" height="15" width="15" class="me-2"/>
                                <span class="txt-color-primary">Contacts</span>
                            </button>
                        </div>
                        <div class="input-group d-md-none">
                            <div class="form-control recipients d-flex flex-row justify-content-between">
                                <div class="d-flex flex-row">
                                    <span class="badge badge-color mx-2 d-flex align-items-center rounded-pill ">Ethan Patel
                                        <button type="button" class="recipients btn-close btn-close-white ms-2" aria-label="Remove"></button>
                                    </span>
                                    <span class="badge badge-color mx-2 d-flex align-items-center rounded-pill">Liam Garcia
                                        <button type="button" class="recipients btn-close btn-close-white ms-2" aria-label="Remove"></button>
                                    </span>
                                    <span class="badge badge-color mx-2 d-flex align-items-center rounded-pill">Sophia Kim
                                        <button type="button" class="recipients btn-close btn-close-white ms-2" aria-label="Remove"></button>
                                    </span>
                                </div>
                                <button class="btn btn-custom txt-color-primary px-0 py-0" type="button">
                                    <img src="~/images/icons/add-contacts.svg" alt="Logo" height="32" width="32" class=""/>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="my-4">
                        <label for="subjectFormControl" class="form-label">Subject/Title</label>
                        <input class="form-control" type="text" aria-label="Subject">
                    </div>
                    <div class="my-4">
                        <label for="messageFormControl" class="form-label" aria-required="true">
                            Message<span class="text-danger">*</span>
                        </label>
                        <textarea class="d-md-none d-block form-control message mobile rounded" rows="3"></textarea>
                        <textarea class="d-none d-md-block form-control message rounded p-1 compose-message" rows="3"></textarea>
                    </div>
                    <!-- Compose send options -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <!-- Attach Files and Voice-to-Text -->
                        <div class="d-flex align-items-center align-self-start">
                            <label class="compose input-group-text bg-white border-0 cursor-pointer me-4 me-md-4">
                                <input type="file" name="files" multiple hidden accept=".pdf, .doc, .docx, .xls, .xlsx, .txt" onchange="displayUploadedFiles(this)">
                                <i class="bi bi-paperclip txt-color-primary fs-5"></i>
                                <span class="d-none d-md-block mx-0 mx-md-2 txt-color-primary">Attach Files</span>
                            </label>

                            <label class="compose input-group-text bg-white border-0 cursor-pointer">
                                <input type="button" name="audioFiles" multiple hidden accept="audio/*" onchange="">
                                <img src="~/images/icons/audio-mobile.svg" height="20" width="20" alt="Inbox" class="d-inline-block me-2 d-md-none" />
                                <i class="bi bi-mic txt-color-primary fs-5 d-none d-md-inline-block"></i>
                                <span class="d-none d-md-block mx-0 mx-md-2 txt-color-primary">Voice-to-Text</span>
                            </label>

                        </div>

                        <!-- Schedule Sending and Send Button -->
                        <div class="d-flex flex-column-reverse flex-md-row align-items-md-center align-items-end">
                            <!-- Schedule Sending-->
                            <div class="btn-group dropdown mt-4 mt-md-0">
                                <div class="form-check d-flex align-items-center me-md-4">
                                    <input class="form-check-input me-2" type="checkbox" id="scheduleSending" onchange="toggleDateTimePicker()">
                                    <label class="form-check-label text-muted" for="scheduleSending">
                                        Schedule Sending
                                    </label>
                                </div>

                                <!-- Dropdown for date and time (appears when Schedule Sending is checked) -->
                                <div class="dropdown d-none custom-dropdown p-0 m-0" id="scheduleDropdown">
                                    <ul class="dropdown-menu show dropdown-menu-start p-0 m-0" aria-labelledby="scheduleSending">
                                        <li class="dropdown-item p-0 m-0 border-0">
                                            <div class="form-group d-flex p-0">
                                                <!-- Date Input -->
                                                <input type="date" class="form-control me-1" value="2024-01-15">
                                                <!-- Time Input -->
                                                <input type="time" class="form-control" value="08:00">
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <!-- Send Button with dropdown -->
                            <div class="btn-group dropup">
                                <button type="button" class="btn btn-orange-fill rounded px-4 mx-2">Send</button>
                                <button type="button" class="btn btn-orange border-orange rounded px-1 dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-chevron-up bold-chevron txt-color-primary align-self-end"></i>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li class="dropdown-item">
                                        <input type="checkbox" id="smsCheckbox">
                                        <label for="smsCheckbox">SMS (GSM)</label>
                                    </li>
                                    <li class="dropdown-item">
                                        <input type="checkbox" id="messagingCheckbox">
                                        <label for="messagingCheckbox">Messaging</label>
                                    </li>
                                    <li class="dropdown-item">
                                        <input type="checkbox" id="emailCheckbox">
                                        <label for="emailCheckbox">Email</label>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="attached-files mt-4">
                        @if (Model.UploadedFiles != null && Model.UploadedFiles.Any())
                        {
                            @foreach (var file in Model.UploadedFiles)
                            {
                                <span class="attached-file-badge d-flex align-items-center">
                                    <i class="bi bi-file-earmark-text-fill me-2"></i> @file.FileName
                                    <button type="button" class="btn-close ms-2" aria-label="Remove"></button>
                                </span>
                            }
                        }
                        else
                        {
                            <span id="no-files-attached" class="d-md-flex d-none text-muted fs-14 ff-microsoft-sans-serif txt-color-tertiary fw-400">No files attached.</span>
                        }
                    </div>
                </form>
            </div>
        </main>
    </div>
</div>

<script>
    function useTemplate(){
        console.log("Use template clicked!");
    }

    function displayUploadedFiles(input) {
        const files = input.files;
        const container = document.querySelector('.attached-files');
        const noFilesMessage = document.getElementById('no-files-attached');

        if (files.length > 0 && noFilesMessage) {
            noFilesMessage.classList.remove('d-md-flex')
            console.log(noFilesMessage.style);
        }

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const fileName = file.name;
            const fileExtension = fileName.split('.').pop().toLowerCase();
            
            let fileIcon = getFileIcon(fileExtension);

            const fileBadge = document.createElement('span');
            fileBadge.classList.add('bg-orange-light', 'text-black', 'px-3', 'py-2', 'attached-file-badge', 'd-flex', 'align-items-center');

            fileBadge.innerHTML = `
                <i class="${fileIcon} me-2"></i> ${fileName}
                <button type="button" class="btn-close ms-2" aria-label="Remove" onclick="removeFile(this)"></button>
            `;
            container.appendChild(fileBadge);
        }
    }


    function getFileIcon(extension) {
        switch (extension) {
            case 'pdf':
                return 'bi bi-file-earmark-pdf';
            case 'doc':
            case 'docx':
                return 'bi bi-file-earmark-word';
            case 'xls':
            case 'xlsx':
                return 'bi bi-file-earmark-spreadsheet';
            case 'txt':
                return 'bi bi-file-earmark-text';
            case 'mp3':
            case 'wav':
            case 'ogg':
                return 'bi bi-file-earmark-music';
            default:
                return 'bi bi-file-earmark';
        }
    }

    function removeFile(button) {
        const fileBadge = button.closest('span');
        fileBadge.remove();
    }

    function removeFile(button) {
        const fileBadge = button.closest('span.attached-file-badge');
        fileBadge.remove();

        const container = document.querySelector('.attached-files');
        const noFilesMessage = document.getElementById('no-files-attached');

        if (container.querySelectorAll('.attached-file-badge').length === 0 && noFilesMessage) {
            noFilesMessage.classList.add('d-md-flex');
        }
    }

    function toggleDateTimePicker() {
        const scheduleDropdown = document.getElementById('scheduleDropdown');
        const checkBox = document.getElementById('scheduleSending');
        
        if (checkBox.checked) {
            scheduleDropdown.classList.remove('d-none');
        } else {
            scheduleDropdown.classList.add('d-none');
        }
    }


</script>